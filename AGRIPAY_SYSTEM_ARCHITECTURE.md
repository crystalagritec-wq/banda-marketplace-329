# ğŸ—ï¸ AgriPay + TradeGuard System Architecture

## ğŸ“Š System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     BANDA MARKETPLACE                            â”‚
â”‚                   AgriPay + TradeGuard System                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚         FRONTEND (React Native)          â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚  â”‚  Checkout Screen                   â”‚  â”‚
        â”‚  â”‚  - Balance check                   â”‚  â”‚
        â”‚  â”‚  - Payment processing              â”‚  â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚  â”‚  Order Success Screen              â”‚  â”‚
        â”‚  â”‚  - Confirm delivery                â”‚  â”‚
        â”‚  â”‚  - Release funds                   â”‚  â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚  â”‚  System Health Dashboard           â”‚  â”‚
        â”‚  â”‚  - Service monitoring              â”‚  â”‚
        â”‚  â”‚  - Cron job tracking               â”‚  â”‚
        â”‚  â”‚  - Alert notifications             â”‚  â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚         BACKEND (tRPC + Hono)            â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚  â”‚  AgriPay Routes                    â”‚  â”‚
        â”‚  â”‚  - createWallet                    â”‚  â”‚
        â”‚  â”‚  - fundWallet                      â”‚  â”‚
        â”‚  â”‚  - getTransactions                 â”‚  â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚  â”‚  TradeGuard Routes                 â”‚  â”‚
        â”‚  â”‚  - holdReserve                     â”‚  â”‚
        â”‚  â”‚  - releaseReserve                  â”‚  â”‚
        â”‚  â”‚  - raiseDispute                    â”‚  â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚  â”‚  System Routes                     â”‚  â”‚
        â”‚  â”‚  - agripayHealth                   â”‚  â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚         DATABASE (Supabase)              â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚  â”‚  Core Tables                       â”‚  â”‚
        â”‚  â”‚  - agripay_wallets                 â”‚  â”‚
        â”‚  â”‚  - wallet_transactions             â”‚  â”‚
        â”‚  â”‚  - tradeguard_reserves             â”‚  â”‚
        â”‚  â”‚  - tradeguard_disputes             â”‚  â”‚
        â”‚  â”‚  - fraud_alerts                    â”‚  â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚  â”‚  Functions                         â”‚  â”‚
        â”‚  â”‚  - create_agripay_wallet()         â”‚  â”‚
        â”‚  â”‚  - hold_reserve()                  â”‚  â”‚
        â”‚  â”‚  - release_reserve()               â”‚  â”‚
        â”‚  â”‚  - auto_release_reserves()         â”‚  â”‚
        â”‚  â”‚  - detect_fraud()                  â”‚  â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚  â”‚  Cron Jobs                         â”‚  â”‚
        â”‚  â”‚  - auto-release-reserves (15min)   â”‚  â”‚
        â”‚  â”‚  - detect-fraud (daily)            â”‚  â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Transaction Flow

### 1. Checkout & Payment

```
User                Checkout           Backend            Database
 â”‚                     â”‚                  â”‚                  â”‚
 â”‚â”€â”€Add to Cartâ”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚                  â”‚
 â”‚                     â”‚                  â”‚                  â”‚
 â”‚â”€â”€Proceed to Payâ”€â”€â”€â”€>â”‚                  â”‚                  â”‚
 â”‚                     â”‚                  â”‚                  â”‚
 â”‚                     â”‚â”€â”€Check Balanceâ”€â”€>â”‚                  â”‚
 â”‚                     â”‚                  â”‚â”€â”€Query Walletâ”€â”€â”€>â”‚
 â”‚                     â”‚                  â”‚<â”€Balanceâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
 â”‚                     â”‚<â”€Balance OKâ”€â”€â”€â”€â”€â”€â”‚                  â”‚
 â”‚                     â”‚                  â”‚                  â”‚
 â”‚â”€â”€Confirm Paymentâ”€â”€â”€>â”‚                  â”‚                  â”‚
 â”‚                     â”‚â”€â”€Process Payâ”€â”€â”€â”€>â”‚                  â”‚
 â”‚                     â”‚                  â”‚â”€â”€Hold Reserveâ”€â”€â”€>â”‚
 â”‚                     â”‚                  â”‚  - Debit buyer   â”‚
 â”‚                     â”‚                  â”‚  - Create reserveâ”‚
 â”‚                     â”‚                  â”‚  - Log txn       â”‚
 â”‚                     â”‚                  â”‚<â”€Reserve IDâ”€â”€â”€â”€â”€â”€â”‚
 â”‚                     â”‚<â”€Order Createdâ”€â”€â”€â”‚                  â”‚
 â”‚<â”€Success Screenâ”€â”€â”€â”€â”€â”‚                  â”‚                  â”‚
```

### 2. Delivery Confirmation & Fund Release

```
User                Order Success      Backend            Database
 â”‚                     â”‚                  â”‚                  â”‚
 â”‚â”€â”€View Orderâ”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚                  â”‚
 â”‚                     â”‚â”€â”€Get Orderâ”€â”€â”€â”€â”€â”€>â”‚                  â”‚
 â”‚                     â”‚                  â”‚â”€â”€Query Reserveâ”€â”€>â”‚
 â”‚                     â”‚                  â”‚<â”€Reserve Dataâ”€â”€â”€â”€â”‚
 â”‚                     â”‚<â”€Show Detailsâ”€â”€â”€â”€â”‚                  â”‚
 â”‚                     â”‚  - Reserve ID    â”‚                  â”‚
 â”‚                     â”‚  - Auto-release  â”‚                  â”‚
 â”‚                     â”‚    countdown     â”‚                  â”‚
 â”‚                     â”‚                  â”‚                  â”‚
 â”‚â”€â”€Confirm Deliveryâ”€â”€>â”‚                  â”‚                  â”‚
 â”‚                     â”‚â”€â”€Release Fundsâ”€â”€>â”‚                  â”‚
 â”‚                     â”‚                  â”‚â”€â”€Release Reserve>â”‚
 â”‚                     â”‚                  â”‚  - Credit seller â”‚
 â”‚                     â”‚                  â”‚  - Credit driver â”‚
 â”‚                     â”‚                  â”‚  - Update status â”‚
 â”‚                     â”‚                  â”‚<â”€Successâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
 â”‚                     â”‚<â”€Funds Releasedâ”€â”€â”‚                  â”‚
 â”‚<â”€Confirmationâ”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚                  â”‚
```

### 3. Auto-Release (Cron Job)

```
Cron Scheduler      Database           Notification
      â”‚                â”‚                    â”‚
      â”‚â”€â”€Every 15minâ”€â”€â”€>â”‚                   â”‚
      â”‚                â”‚                    â”‚
      â”‚                â”‚â”€â”€Find Expiredâ”€â”€â”€â”€â”€>â”‚
      â”‚                â”‚  Reserves          â”‚
      â”‚                â”‚  (>72 hours)       â”‚
      â”‚                â”‚                    â”‚
      â”‚                â”‚â”€â”€Release Eachâ”€â”€â”€â”€â”€>â”‚
      â”‚                â”‚  - Credit seller   â”‚
      â”‚                â”‚  - Credit driver   â”‚
      â”‚                â”‚  - Update status   â”‚
      â”‚                â”‚                    â”‚
      â”‚                â”‚â”€â”€Notify Usersâ”€â”€â”€â”€â”€>â”‚
      â”‚                â”‚                    â”‚â”€â”€Send Email/SMS
      â”‚                â”‚                    â”‚
```

---

## ğŸ’° Money Flow

### Payment Split

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BUYER PAYMENT                         â”‚
â”‚                      KES 1,000                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              TRADEGUARD RESERVE (Escrow)                 â”‚
â”‚                      KES 1,000                           â”‚
â”‚                   Status: HELD                           â”‚
â”‚                Auto-release: 72 hours                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼ (After confirmation)
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼               â–¼               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ SELLER â”‚      â”‚ DRIVER â”‚     â”‚PLATFORMâ”‚
    â”‚KES 850 â”‚      â”‚KES 100 â”‚     â”‚ KES 50 â”‚
    â”‚  85%   â”‚      â”‚  10%   â”‚     â”‚   5%   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Reserve States

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BUYER   â”‚
â”‚  WALLET  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚ Payment
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     Confirm      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RESERVE  â”‚â”€â”€â”€â”€Deliveryâ”€â”€â”€â”€â”€>â”‚ RELEASED â”‚
â”‚  (HELD)  â”‚                  â”‚          â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                             â”‚
     â”‚ Dispute                     â”‚ Split
     â–¼                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DISPUTED â”‚                  â”‚  SELLER  â”‚
â”‚          â”‚                  â”‚  DRIVER  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                  â”‚ PLATFORM â”‚
     â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ Resolve
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ REFUNDED â”‚
â”‚   OR     â”‚
â”‚ RELEASED â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ›¡ï¸ Security Layers

### 1. Authentication Layer
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User Authentication (Supabase)     â”‚
â”‚  - Session tokens                   â”‚
â”‚  - JWT validation                   â”‚
â”‚  - Role-based access                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Authorization Layer
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Row Level Security (RLS)           â”‚
â”‚  - User can only access own wallet  â”‚
â”‚  - Seller can view own reserves     â”‚
â”‚  - Admin has full access            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Transaction Security
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Transaction Integrity              â”‚
â”‚  - Atomic operations                â”‚
â”‚  - Double-spend prevention          â”‚
â”‚  - Balance verification             â”‚
â”‚  - Audit logging                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. Fraud Detection
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Automated Fraud Detection          â”‚
â”‚  - Daily scans                      â”‚
â”‚  - Pattern analysis                 â”‚
â”‚  - Wallet freezing                  â”‚
â”‚  - Alert generation                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Data Models

### AgriPay Wallet
```typescript
interface AgriPayWallet {
  id: string;
  user_id: string;
  balance: number;
  currency: string;
  status: 'active' | 'frozen' | 'suspended';
  verification_level: 'basic' | 'verified' | 'premium';
  daily_limit: number;
  created_at: timestamp;
  updated_at: timestamp;
}
```

### TradeGuard Reserve
```typescript
interface TradeGuardReserve {
  id: string;
  order_id: string;
  buyer_id: string;
  seller_id: string;
  driver_id?: string;
  buyer_wallet_id: string;
  seller_wallet_id: string;
  driver_wallet_id?: string;
  transaction_id: string;
  total_amount: number;
  seller_amount: number;
  driver_amount?: number;
  platform_fee: number;
  status: 'held' | 'released' | 'refunded' | 'disputed';
  auto_release_at: timestamp;
  released_at?: timestamp;
  created_at: timestamp;
}
```

### Wallet Transaction
```typescript
interface WalletTransaction {
  id: string;
  wallet_id: string;
  type: 'deposit' | 'withdrawal' | 'payment' | 'refund' | 'reserve_hold' | 'reserve_release';
  amount: number;
  balance_before: number;
  balance_after: number;
  reference_type?: string;
  reference_id?: string;
  status: 'pending' | 'completed' | 'failed';
  metadata?: json;
  created_at: timestamp;
}
```

---

## ğŸ” Monitoring Architecture

### Health Check System
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              SYSTEM HEALTH DASHBOARD                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Service Monitors                                 â”‚  â”‚
â”‚  â”‚  - Database (connection, response time)           â”‚  â”‚
â”‚  â”‚  - AgriPay (wallets, transactions)                â”‚  â”‚
â”‚  â”‚  - TradeGuard (reserves, disputes)                â”‚  â”‚
â”‚  â”‚  - Fraud Detection (alerts)                       â”‚  â”‚
â”‚  â”‚  - Payouts (pending requests)                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Cron Job Monitors                                â”‚  â”‚
â”‚  â”‚  - auto-release-reserves (last run, next run)     â”‚  â”‚
â”‚  â”‚  - detect-fraud (last run, next run)              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Alert System                                     â”‚  â”‚
â”‚  â”‚  - Critical (red)                                 â”‚  â”‚
â”‚  â”‚  - Warning (yellow)                               â”‚  â”‚
â”‚  â”‚  - Info (blue)                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Alert Thresholds
```
Service              Warning Level        Critical Level
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Fraud Alerts         > 10 open            > 50 open
Open Disputes        > 5 open             > 20 open
Active Reserves      > 100 held           > 500 held
Response Time        > 500ms              > 2000ms
Database             Slow queries         Connection fail
Cron Jobs            Missed 1 run         Missed 3 runs
```

---

## ğŸš€ Deployment Architecture

### Production Stack
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PRODUCTION                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Frontend (Expo)                                  â”‚  â”‚
â”‚  â”‚  - React Native Web                               â”‚  â”‚
â”‚  â”‚  - iOS App                                        â”‚  â”‚
â”‚  â”‚  - Android App                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Backend (Node.js)                                â”‚  â”‚
â”‚  â”‚  - tRPC API                                       â”‚  â”‚
â”‚  â”‚  - Hono Server                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Database (Supabase)                              â”‚  â”‚
â”‚  â”‚  - PostgreSQL                                     â”‚  â”‚
â”‚  â”‚  - pg_cron extension                              â”‚  â”‚
â”‚  â”‚  - RLS policies                                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ˆ Scalability Considerations

### Horizontal Scaling
- Load balancer for API servers
- Read replicas for database
- Caching layer (Redis)
- CDN for static assets

### Vertical Scaling
- Database connection pooling
- Query optimization
- Index optimization
- Batch processing

### Performance Optimization
- Lazy loading
- Pagination
- Background jobs
- Async processing

---

## ğŸ” Backup & Recovery

### Automated Backups
- Daily database snapshots
- Transaction log backups
- Point-in-time recovery
- Geo-redundant storage

### Disaster Recovery
- Backup restoration procedures
- Failover mechanisms
- Data integrity checks
- Recovery time objectives (RTO)

---

## ğŸ“ Support & Maintenance

### Monitoring
- Real-time health dashboard
- Automated alerts
- Performance metrics
- Error tracking

### Maintenance Windows
- Scheduled updates
- Database maintenance
- Security patches
- Feature deployments

---

**Last Updated**: 2025-10-07

**Version**: 1.0.0

**Status**: Production Ready âœ…
